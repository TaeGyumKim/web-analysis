 /*
 - 팝업창에서 카렌다를 쓸 경우 이용되는 javascript이다.
 - 변형없이 그대로 이용한다.
 - 사용례 http://localhost:7001/ngmWeb/pageflows/sample/calendar_popup/Calendar_popupController.jpf
 */

/* 호출한 Object의 저장 */
 var target;
 var _isTodayBtnYn = true;
 var _calendar_img_root= pageContextPath;
 
/* [Day2] 2015-04-01 달력 a에 있는 href를 제거 */
 jQuery().ready(function(){
	 jQuery("a[title='달력 팝업창 열기']").removeAttr("href");
 });
/* 정명교 */

document.write("<div id=calendar  oncontextmenu='return false' ondragstart='return false' onselectstart='return false' style=\"z-index: 9999;position:absolute;display:none;\"></div>");/* style=\"height:123px;display:none;position: absolute; z-index: 99\" */
document.write("<div id=calendarMt  oncontextmenu='return false' ondragstart='return false' onselectstart='return false' style=\"position:absolute;display:none;\"></div>");/* style=\"height:123px;display:none;position: absolute; z-index: 99\" */
document.write("<div id=calendarSet style=\"display:none;position:\"></div>");

//다국어 메시지 변수 처리
var busienssErrMsg = "";
if(language == "KO") {
	busienssErrMsg = "영업일이 아닙니다";
} else {
	busienssErrMsg = "Not a busienss day";
}

/**
 * 달력 생성시 datefield 에 오늘 날짜 셋팅해주는 함수
 * @param {} calendarId
 */
function calendarDefaultSet(calendarId) {
	datToday = new Date();
	var todayValue = datToday.getFullYear().toString()+"-"
		+day2((datToday.getMonth()+1))+"-"+day2(datToday.getDate().toString());

	document.getElementById(calendarId).value = todayValue;
}


/**
 *  달력 날짜가져오기
 */
function getCalendarDate(popID, calendarId){
	var calID = popID+"_"+calendarId;
	var returnDate = _datefieldArr[calID].getRawValue();

	return returnDate;
}

Calendar.defaultParentElement = document.getElementById("wrap") ? document.getElementById("wrap") : null;
Calendar.parentElement = Calendar.defaultParentElement;
Calendar.setParentElement = function(parentElementId){
    Calendar.parentElement = (document.getElementById(parentElementId)) ? (document.getElementById(parentElementId)) : Calendar.defaultParentElement ;
}

/**
 *  달력
 */
function Calendar(obj, xtarget, locale, evt, isMonth, isTodayBtn) {
 var now = obj.value.split("-");
 var x, y;
 var theEvent = evt ? evt : window.event;

 /* Object 저장 */
 target = obj;

 /* 달력 위치 잡기 */

 /* 이벤트 좌포 */
if (!evt) var evt = window.event; /* 이벤트 검사 */

if (evt.pageX || evt.pageY) { /* pageX/Y 표준 검사 */
 x = evt.pageX;
 y = evt.pageY;

}
else if (evt.clientX || evt.clientY) {  /* clientX/Y 표준 검사 Opera */
 x = document.documentElement.scrollLeft + evt.clientX;
 y = document.documentElement.scrollTop + evt.clientY;
 if(Calendar.parentElement != undefined && Calendar.parentElement != null) {
    x -= parseInt(Calendar.parentElement.offsetLeft, 10);
    y -= parseInt(Calendar.parentElement.offsetTop, 10);
 }
}

/* 팝업에서 달력 띄울시에 달력이 짤리게 되는 현상을 위해서 팝업창에서 달력의 위치 잡는 로직 추가 */
if(opener != undefined) {
	// 달력 높이 : 160
	if(document.documentElement.clientHeight - y < 160) {
		y =   y - 160;
	}else {
		
	}
}

var xData = 0;

if (navigator.appName == "Netscape") {
  document.getElementById('calendar').style.top  = (y+5) +"px";
  document.getElementById('calendar').style.left  = (x - xData)+"px";
  document.getElementById('calendarMt').style.top  = (y+5) +"px";
  document.getElementById('calendarMt').style.left  = (x - xData)+"px";
}else{
  /* document.getElementById('calendar').style.top = y+5;
  document.getElementById('calendar').style.left = x - xData;
  document.getElementById('calendarMt').style.top = y+5;
  document.getElementById('calendarMt').style.left = x - xData; */
  
  jQuery("#calendar").css("top", y+5).css("left", x - xData);
  jQuery("#calendarMt").css("top", y+5).css("left", x - xData);
}


 var fromday = eval( "document.getElementById(\""+obj.name+"fromday\")" );
 var today   = eval( "document.getElementById(\""+obj.name+"today\")" );
if(fromday != undefined) {
	 var fromday = eval( "document.getElementById(\""+obj.name+"fromday\")" ).value;
	 var today = eval( "document.getElementById(\""+obj.name+"today\")" ).value;
 }

 /* today 버튼의 존재여부. 달력의 높이 속성이 달라진다. */
 /* if(isTodayBtn == undefined) _isTodayBtnYn = true; */

 /* fromday, today가 존재하면 기간 조회 달력임. */
 if(fromday != undefined && today != undefined){
    var nowday = "";
 	if(now.length == 3) {
 		nowday = now[0] + now[1] + now[2];
 	}else{
 		now = new Date();
 		nowday = ""+now.getFullYear() + (now.getMonth()+1 >= 10 ? now.getMonth()+1:"0"+(now.getMonth()+1))
 					+ (now.getDate() >= 10 ? ""+now.getDate():"0"+now.getDate());
 	}
 	Show_cal_period(nowday,fromday,today, false, (isTodayBtn == undefined)?true:isTodayBtn);
 } else if (isMonth) {  /* 월달력일경우, */
 	now = new Date();
 	Show_Month_cal(now.getFullYear(), (now.getMonth()+1 >= 10 ? now.getMonth()+1:"0"+(now.getMonth()+1)));
 	openShim(document.getElementById('calendarMt'),null);
 	Calendar.addEvent(document, "mousedown", closeMonCal);
 } else if (now.length == 3) {             /* 정확한지 검사 */
  	Show_cal(now[0],now[1],now[2], false, (isTodayBtn == undefined)?true:isTodayBtn);   /* 넘어온 값을 년월일로 분리 */
 } else {
  	now = new Date();
   Show_cal(now.getFullYear(), now.getMonth()+1, now.getDate(), false, (isTodayBtn == undefined)?true:isTodayBtn);   /* 현재 년/월/일을 설정하여 넘김. */
 }

  openShim(document.getElementById('calendar'),null);
  Calendar.addEvent(document, "mousedown", closeCal);
}

Calendar.is_ie = ( (navigator.userAgent.toLowerCase().indexOf("msie") != -1) &&  (navigator.userAgent.toLowerCase().indexOf("opera") == -1) );

Calendar.addEvent = function(el, evname, func) {
	if (Calendar.is_ie) {
		el.attachEvent("on" + evname, func);
	} else {
		el.addEventListener(evname, func, true);
	}
};

Calendar.removeEvent = function(el, evname, func) {
	if (Calendar.is_ie) {
		el.detachEvent("on" + evname, func);
	} else {
		el.removeEventListener(evname, func, true);
	}
};

Calendar.getElement = function(ev) {
	if (Calendar.is_ie) {
		return window.event.srcElement;
	} else {
		return ev.currentTarget;
	}
};

Calendar.getTargetElement = function(ev) {
	if (Calendar.is_ie) {
		return window.event.srcElement;
	} else {
		return ev.target;
	}
};

function Show_Month_cal(sYear, sMonth, chCalendar) {
	var Month_name = null;
	var Weekday_Display_name = new Array("Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat");
	 	Month_name =  new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");
	var Cal_HTML = "<div class='cmt_wrap'>"
			+"<div class='cmt_head clear'>"
			+"<a href='#none' class='btn_prev' onClick='Show_Month_cal("+(sYear-1)+","+sMonth+",\"USE\")'>"
			+"<img src='"+_calendar_img_root+"/img/common/calendar/btn_calendar_prev1.gif' alt='preview' title='preview' /></a>"
			+"<p class='txt_year'>"+sYear+"</p>"
			+"<a href='#none' class='btn_next' onClick='Show_Month_cal("+(sYear+1)+","+sMonth+",\"USE\")'>"
			+"<img src='"+_calendar_img_root+"/img/common/calendar/btn_calendar_next1.gif' alt='next' title='next' /></a>"
			+"</div>"
			+"<ul class='month_list clear'>";


	for(var i=1; i < 13; i++) {
		if(i == sMonth) {
			Cal_HTML+="<li class='here'><a href='#none' onClick='doClickMt("+sYear+","+i+")'><span class='month_number'>"+i+"</span><span class='month_text'>"+Month_name[i-1]+"</span></a></li>";
		} else {
			Cal_HTML+="<li><a href='#none' onClick='doClickMt("+sYear+","+i+")'><span class='month_number'>"+i+"</span><span class='month_text'>"+Month_name[i-1]+"</span></a></li>";
		}
	}

	Cal_HTML += "</ul></div>";

	 /* 영업일 체크->  달력 생성-> 화면 보여지기 순으로 보여주기 위함 ( chCalendar 가 USE인것은 달력내에서 이전 다음달 클릭시임) */
	 if(chCalendar == "USE"){
	 	document.getElementById('calendarMt').style.display ="block";
	 	openShim(document.getElementById('calendarMt'),null);
	 }else{
	 	 if(document.getElementById('calendarMt').style.display == "block") {
	 	 	document.getElementById('calendarMt').style.display ="none";
	 	 	closeShim(document.getElementById('calendarMt'));
	 	 }else{
	 	 	document.getElementById('calendarMt').style.display ="block";
	 	 	openShim(document.getElementById('calendarMt'),null);
	 	 }
	 }
	 document.getElementById("calendarMt").innerHTML = Cal_HTML;
	 document.getElementById("calendarMt").focus();

	 /* 변수 초기화 */
	 calInit();

}


/* 달력 보여주기 - 영업일 체크 달력은 ajax호출후 보여주고, 일반달력은 그냥 보여주도록 조건분 */
function Show_cal(sYear, sMonth, sDay, chCalendar, isTodayBtn) {
	if(_isHolidayCheckMode == "ON"){
		calAjaxSubmit(sYear+""+day2(sMonth)+day2(sDay), chCalendar, '','','',isTodayBtn);
	}else{
		Show_cal3(sYear, sMonth, sDay, chCalendar, isTodayBtn);
	}
}
function moveElement(elementID,final_x,final_y,interval) {
  if (!document.getElementById) return false;
  if (!document.getElementById(elementID)) return false;
  var elem = document.getElementById(elementID);
  if (elem.movement) {
    clearTimeout(elem.movement);
  }
  if (!elem.style.left) {
    elem.style.left = "0px";
  }
  if (!elem.style.top) {
    elem.style.top = "0px";
  }
  var xpos = parseInt(elem.style.left);
  var ypos = parseInt(elem.style.top);
  if (xpos == final_x && ypos == final_y) {
    return true;
  }
  if (xpos < final_x) {
    var dist = Math.ceil((final_x - xpos)/10);
    xpos = xpos + dist;
  }
  if (xpos > final_x) {
    var dist = Math.ceil((xpos - final_x)/10);
    xpos = xpos - dist;
  }
  if (ypos < final_y) {
    var dist = Math.ceil((final_y - ypos)/10);
    ypos = ypos + dist;
  }
  if (ypos > final_y) {
    var dist = Math.ceil((ypos - final_y)/5);
    ypos = ypos - dist;
  }
  elem.style.left = xpos + "px";
  elem.style.top = ypos + "px";
  var repeat = "moveElement('"+elementID+"',"+final_x+","+final_y+","+interval+")";
  elem.movement = setTimeout(repeat,interval);
  document.getElementById(elementID).focus();
  
}

/* EXT 디자인과 맞춘 달력 */
function Show_cal3(sYear, sMonth, sDay, chCalendar, isTodayBtn) {
	 var Months_day = new Array(0,31,28,31,30,31,30,31,31,30,31,30,31);
	 var Weekday_name = new Array("Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat");
	 var Weekday_Display_name = new Array("Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat");
	 var Month_name = null;
	 if(language == "KO") {
	 	Month_name =  new Array("1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월");
	 } else {
	 	Month_name =  new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");
	 }

	 var intThisYear = new Number(), intThisMonth = new Number(), intThisDay = new Number();
	 document.getElementById("calendar").innerHTML = "";

	 datToday = new Date();             /* 현재 날자 설정 */

	 intThisYear = parseInt(sYear,10);
	 intThisMonth = parseInt(sMonth,10);
	 intThisDay = parseInt(sDay,10);

	 if (intThisYear == 0) intThisYear = datToday.getFullYear();    /* 값이 없을 경우 */
	 if (intThisMonth == 0) intThisMonth = parseInt(datToday.getMonth())+1; /* 월 값은 실제값 보다 -1 한 값이 돼돌려 진다. */
	 if (intThisDay == 0) intThisDay = datToday.getDate();

	 switch(intThisMonth) {
	  case 1:
	    intPrevYear = intThisYear -1;
	    intPrevMonth = 12;
	    intNextYear = intThisYear;
	    intNextMonth = 2;
	    break;
	  case 12:
	    intPrevYear = intThisYear;
	    intPrevMonth = 11;
	    intNextYear = intThisYear + 1;
	    intNextMonth = 1;
	    break;
	  default:
	    intPrevYear = intThisYear;
	    intPrevMonth = parseInt(intThisMonth) - 1;
	    intNextYear = intThisYear;
	    intNextMonth = parseInt(intThisMonth) + 1;
	    break;
	 }

	 NowThisYear = datToday.getFullYear();          /* 현재 년 */
	 NowThisMonth = datToday.getMonth()+1;          /* 현재 월 */
	 NowThisDay = datToday.getDate();               /* 현재 일 */

	 datFirstDay = new Date(intThisYear, intThisMonth-1, 1);      /* 현재 달의 1일로 날자 객체 생성(월은 0부터 11까지의 정수(1월부터 12월)) */
	 intFirstWeekday = datFirstDay.getDay();        /* 현재 달 1일의 요일을 구함 (0:일요일, 1:월요일) */

	 intSecondWeekday = intFirstWeekday;
	 intThirdWeekday = intFirstWeekday;

	 datThisDay = new Date(intThisYear, intThisMonth, intThisDay);    /* 넘어온 값의 날자 생성 */
	 intThisWeekday = datThisDay.getDay();              /* 넘어온 날자의 주 요일 */

	 varThisWeekday = Weekday_name[intThisWeekday];     /* 현재 요일 저장 */

	 intPrintDay = 1;                /* 달의 시작 일자 */
	 secondPrintDay = 1;
	 thirdPrintDay = 1;

	 Stop_Flag = 0;

	 if ((intThisYear % 4)==0) {             /* 4년마다 1번이면 (사로나누어 떨어지면) */
	  if ((intThisYear % 100) == 0) {
	   if ((intThisYear % 400) == 0) {
	    Months_day[2] = 29;
	   }
	  } else {
	   Months_day[2] = 29;
	  }
	 }
	 intLastDay = Months_day[intThisMonth];          /* 마지막 일자 구함 */
	 Stop_flag = 0;

	 var prevMonth = intThisMonth - 1;
	 var nextMonth = intThisMonth + 1;
	 var prevYear = intThisYear;
	 var nextYear = intThisYear;
	 if(intThisMonth == 1) {
	 	prevMonth = 12;
	 	prevYear = intThisYear - 1;
	 } else if (intThisMonth == 12) {
	    nextMonth = 1;
	 	nextYear = intThisYear + 1;
	 }

    var prevNextDay = "";
	if(intThisDay == intLastDay) {	prevNextDay = "01";	}
	else {prevNextDay = intThisDay;}

	Cal_HTML = "<div class='month_chagne'>"
		+"<a href='#none' onClick='Show_cal("+prevYear+","+prevMonth+","+prevNextDay+",\"USE\","+isTodayBtn+"); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/left-btn.gif'  alt='이전달'  title='' class='calendar_left'/></a>"
		+"<a href='#none' onClick='Show_cal("+nextYear+","+nextMonth+","+prevNextDay+",\"USE\","+isTodayBtn+"); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/right-btn.gif'  alt='다음달'  title='' class='calendar_right'/></a>"
		+"<p><b><a href='#none'  onclick='moveElement(\"yearCalendar\",0, 0, 25); return false;'>"+intThisYear+"."+(intThisMonth<10?'0'+intThisMonth:''+intThisMonth)+"</a></b></p>"
		+"</div>"
		+"<TABLE cellpadding='0' cellspacing='0'  class='table_calendar'>"
		+"<THEAD>"
		+"<TR>"
		+"<TH scope='col' class='Sunday'><SPAN>S</SPAN></TH>"
		+"<TH scope='col' class='Monday'><SPAN>M</SPAN></TH>"
		+"<TH scope='col' class='Tuesday'><SPAN>T</SPAN></TH>"
		+"<TH scope='col' class='Wednesday'><SPAN>W</SPAN></TH>"
		+"<TH scope='col' class='Thursday'><SPAN>T</SPAN></TH>"
		+"<TH scope='col' class='Friday'><SPAN>F</SPAN></TH>"
		+"<TH scope='col' class='Saturday'><SPAN>S</SPAN></TH>"
		+"</TR>"
		+"</THEAD>"
		+"<TBODY>";


	var clsStr = "";
	var calRowCnt =0;
	var prevMonLastDay = Months_day[(intThisMonth==1)?11:intThisMonth-1];
	var prevMonPrevPos = "";
	if(intThirdWeekday == 0) {
		prevMonPrevPos = prevMonLastDay - 6;
	} else {
		prevMonPrevPos = prevMonLastDay - (intThirdWeekday-1);
	}
	var weekLength = 7;
	if(intThirdWeekday == 0) {
		Cal_HTML += "<TR>";
		for (intLoopDay=1; intLoopDay <= 7; intLoopDay++) {
			Cal_HTML += "<TD ";
			if(intLoopDay == 1) {
				Cal_HTML += "class='sun'>"
				         + "<a href='#none' class='prevday'>"+prevMonPrevPos+"</a></TD>";
	 	 	} else {
	 	 		Cal_HTML += "><a href='#none' class='prevday'>"+prevMonPrevPos+"</a></TD>";
	 	 	}
			prevMonPrevPos++;
	 	 	intThirdWeekday--;
		}
 	 	Cal_HTML += "</TR>";
 	 	weekLength = 6;
	}
	for (intLoopWeek=1; intLoopWeek < weekLength; intLoopWeek++) {      /* 주단위 루프 시작, 최대 6주 */
	 	Cal_HTML += "<TR>";
		for (intLoopDay=1; intLoopDay <= 7; intLoopDay++) {       /* 요일단위 루프 시작, 일요일 부터 */
			clsStr = "";

			if (intThirdWeekday > 0) {           /* 첫주 시작일이 1보다 크면 */
				Cal_HTML += "<TD ";
				if(intLoopDay == 1) {
					Cal_HTML += "class='sun'>"
					         + "<a href='#none' class='prevday'>"+prevMonPrevPos+"</a></td>";
		 	 	} else {
		 	 		Cal_HTML += "><a href='#none' class='prevday'>"+prevMonPrevPos+"</a></td>";
		 	 	}
				prevMonPrevPos++;
		 	 	intThirdWeekday--;
			} else {
			    if (thirdPrintDay > intLastDay) {        /* 입력 날짝 월말보다 크다면 */
		 	 		Cal_HTML += "<td>";
		 	 			Cal_HTML += "<a href='#none' class='nextday'>" + (thirdPrintDay-intLastDay)+"</a></td>";
			    } else {
			    	/*
			    		입력날짜가 현재월에 해당 되면
			    		공휴일 temp에 해당일이 존재하는지 체크 - 존재하면 링크없앰
			    	*/
			    	var isHolidayCheck = "";
			    	if(_holidayArr.length > 0){
				    	isHolidayCheck = isHolidayCheckFunction(intThisYear+""+day2(intThisMonth).toString()+day2(thirdPrintDay).toString());
			    	}

					var tdclass = "";
	     			switch(intLoopDay) {
						case 1:             /* 일요일이면 빨간 색으로 */
							if(isHolidayCheck == "Y"){ /* 휴일 */
	      						Cal_HTML += "<TD class=' x-date-disabled' title='"+busienssErrMsg+"'>";
	      					} else {
								Cal_HTML += "<TD class = 'sun'>";
	      					}
							break;
						case 7:
							if(isHolidayCheck == "Y"){ /* 휴일 */
	      						Cal_HTML += "<TD class=' x-date-disabled' title='"+busienssErrMsg+"'>";
	      					} else {
								Cal_HTML += "<TD class = 'sat'>";
	      					}
							break;
	      				default:
	      					if(isHolidayCheck == "Y"){ /* 휴일 */
	      						Cal_HTML += "<TD class=' x-date-disabled' title='"+busienssErrMsg+"'>";
	      					} else if(thirdPrintDay == NowThisDay) {
								Cal_HTML += "<TD class='today'>";
							} else {
								Cal_HTML += "<TD>";
							}
	       					break;
	     			}
					if(isHolidayCheck == "Y"){	/* 휴일 */
						Cal_HTML +=  "<a href='#none' class='x-date-date'><em><span>"+thirdPrintDay+"</span></em></a>" ;
					}else{	/* 영업일 */
						if(thirdPrintDay == NowThisDay) {
							Cal_HTML += "<a href='#none' alt="+intThisYear+"-"+day2(intThisMonth).toString()+"-"+day2(thirdPrintDay).toString()+" "
							 + " onClick='doClick(\"" + intThisYear+"-"+day2(intThisMonth).toString()+"-"+day2(thirdPrintDay).toString()+ "\"); return false;'><B>"+thirdPrintDay + "</B></a>"; /* firefox에선 cursor:hand단독으로 사용하면 안됨 */

						} else {
							Cal_HTML += "<a href='#none' alt="+intThisYear+"-"+day2(intThisMonth).toString()+"-"+day2(thirdPrintDay).toString()+" "
							 +" onClick='doClick(\"" + intThisYear+"-"+day2(intThisMonth).toString()+"-"+day2(thirdPrintDay).toString()+ "\"); return false;'>"+thirdPrintDay + "</a>"; /* firefox에선 cursor:hand단독으로 사용하면 안됨 */

						}
					}
	    		}
			    thirdPrintDay++;
		   	}
	   		Cal_HTML += "</TD>";
	  	} /* end for */
	  	Cal_HTML += "</TR>";
		calRowCnt ++;
	  	if (Stop_Flag==1) break;
	 } /* end for */

	 Cal_HTML += "</TBODY></TABLE>";

	 /* 바닥에 today 버튼 생성 */
	 if(isTodayBtn) {
		 Cal_HTML += "<div class='text_center mar_t2'>"
	              +"<a class='btn_tbl_func_a btn_sys1' href='#none' onClick='doClick(\"" + NowThisYear+"-"+day2(NowThisMonth.toString())+"-"+day2(NowThisDay.toString())+ "\"); return false;'  ><span>Today</span></a>"
	              +"</div>";
	 }

	  /* 달력 상단 가운데에  달 선택하는 부분 */
	  Cal_HTML +="<div class='year_calendar' id='yearCalendar' style='top:-160px;'>"
	 		  +"<div class='clear'>";

	  /* YEAR */
	  Cal_HTML +="<div id='year_Content'><table cellspacing='0' width='90'>"
		      +"<tbody><tr><th colspan='2'>Year</th> </tr>"
		      +"<tr>"
		      +"<td><a href='#none' onClick='refreshYearContent(\"prev\",NowThisYear-5); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/left2-btn.gif' alt='' title='' /></a></td>"
		      +"<td><a href='#none' onClick='refreshYearContent(\"next\",NowThisYear+6); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/right2-btn.gif' alt='' title='' /></a></td>"
		      +"</tr>";

	  /* 현재 년도 기준으로 -4 +5년 셋팅 */
	  for(var i=NowThisYear-4; i <= NowThisYear; i++) {
	  	Cal_HTML += "<tr>";
	  	if(i == NowThisYear) {
	  		Cal_HTML += "<td><a href='#none' id='"+i+"' onClick='setYearCal("+i+",NowThisYear-4); return false;' class='here'>"+ i+"</a></td><td><a href='#none' id='"+(i+5)+"' onClick='setYearCal("+(i+5)+",NowThisYear-4); return false;'>"+(i+5)+"</a></td>";
	  	} else {
	  		Cal_HTML += "<td><a href='#none' id='"+i+"' onClick='setYearCal("+i+",NowThisYear-4); return false;'>"+ i+"</a></td><td><a href='#none' id='"+(i+5)+"' onClick='setYearCal("+(i+5)+",NowThisYear-4); return false;'>"+(i+5)+"</a></td>";
	  	}
	  	Cal_HTML += "</tr>";
	  }
	  Cal_HTML += "</tbody></table></div>";


	  /*  Month */
	  Cal_HTML +="<table cellspacing='0' width='72'>"
	 		  +"<tbody>"
	 		  +"<tr><th colspan='2'>Month</th></tr>";


	  for(var i=0; i < 6; i++) {
	 	Cal_HTML +="<tr>";
		if(i==(NowThisMonth-1)){
			Cal_HTML += "<td><a href='#none' id='"+i+"' onClick='setMonthCal("+i+"); return false;' class='here'>"+Month_name[i]+"</a></td>";
		} else {
			Cal_HTML += "<td><a href='#none' id='"+i+"' onClick='setMonthCal("+i+"); return false;'>"+Month_name[i]+"</a></td>";
		}

		if(i+6==(NowThisMonth-1)){
			Cal_HTML += "<td><a href='#none' id='"+(i+6)+"' onClick='setMonthCal("+(i+6)+"); return false;' class='here'>"+Month_name[i+6]+"</a></td>";
		} else {
			Cal_HTML += "<td><a href='#none' id='"+(i+6)+"' onClick='setMonthCal("+(i+6)+"); return false;'>"+Month_name[i+6]+"</a></td>";
		}

	 	Cal_HTML +="</tr>";
	  }

	 Cal_HTML +="</tbody></table>";


 
	  Cal_HTML += "</div>"; /* clear div 닫음! */
	  Cal_HTML += "<div class='text_center mar_t12'>";
		  // 영문웹분기
		  if("EN" == _fU_localeCode){
			  Cal_HTML += "<a class='btn_tbl_func_a btn_sys1' href='#none' onclick='goChangeValueShow_Cal("+isTodayBtn+"); return false;'> <span>Confirm</span></a>";
			  Cal_HTML += "<a class='btn_tbl_func_a btn_sys1' href='#none' onclick='moveElement(\"yearCalendar\",0, -160, 0); return false;'> <span>Cancel</span></a>";
		  }else{
			  Cal_HTML += "<a class='btn_tbl_func_a btn_sys1' href='#none' onclick='goChangeValueShow_Cal("+isTodayBtn+"); return false;'> <span>확인</span></a>";
			  Cal_HTML += "<a class='btn_tbl_func_a btn_sys1' href='#none' onclick='moveElement(\"yearCalendar\",0, -160, 0); return false;'> <span>취소</span></a>";
		  }	  
	 Cal_HTML += "</div>";

	 Cal_HTML += "</div>"; /* year_calendar div 닫음! */

	 /* 영업일 체크->  달력 생성-> 화면 보여지기 순으로 보여주기 위함 ( chCalendar 가 USE인것은 달력내에서 이전 다음달 클릭시임) */
	 if(chCalendar == "USE"){
	 	document.getElementById('calendar').style.display ="block";
	 	openShim(document.getElementById('calendar'),null);
	 }else{
	 	 if(document.getElementById('calendar').style.display == "block") {
	 	 	document.getElementById('calendar').style.display ="none";
	 	 	closeShim(document.getElementById('calendar'));
	 	 }else{
	 	 	document.getElementById('calendar').style.display ="block";
	 	 	openShim(document.getElementById('calendar'),null);
	 	 }
	 }
	 document.getElementById("calendar").innerHTML = Cal_HTML;
	 document.getElementById("calendar").focus();

	 /* 변수 초기화 */
	 calInit();
}
var _extMonthLayer = "";
var _extYearLayer = "";
/* 월 선택 레이어에서 선택한 월 값 셋팅 */
function setMonthCal(selMonth) {
	var Month_value = new Array("1","2","3","4","5","6","7","8","9","10","11","12");

	for(var i=0; i < 12; i++) {
		if(i == selMonth) {
			document.getElementById(i).className = "here";
		} else {
			document.getElementById(i).className = "";
		}
	}
	_extMonthLayer = Month_value[selMonth];
}
/* 년도 선택 레이어에서 선택한 년도 값 셋팅 */
function setYearCal(selYear, startYearPos) {
	for(var i=startYearPos; i < startYearPos+10; i++) {
		if(i == selYear) {
			document.getElementById(i).className = "here";
		} else {
			document.getElementById(i).className = "";
		}
	}
	_extYearLayer = selYear;
}
/* 달,년도 선택 레이어에서 값 선택하고 확인 버튼 불렀을시 호출 */
function goChangeValueShow_Cal(isTodayBtn) {
	if(_extYearLayer == undefined || _extYearLayer == '') {
		_extYearLayer = NowThisYear;
	} else if(_extMonthLayer == undefined || _extMonthLayer == '') {
		_extMonthLayer = NowThisMonth;
	}

	Show_cal(_extYearLayer,_extMonthLayer,NowThisDay,'USE',isTodayBtn);
	moveElement('yearCalendar',0, -160, 0);
}

var _extNextYear = "";
var _extPrevYear = "";
function refreshYearContent(type, yearPos){
	var Year_HTML = "<table cellspacing='0' width='90'>"
	      +"<tbody><tr><th colspan='2'>Year</th></tr>"
	      +"<tr>";
	var startPos = "";
	if(type == 'next') { /* 다음년도 버튼 클릭시 */
		_extNextYear = yearPos + 10;
		_extPrevYear = yearPos - 1;
		Year_HTML+="<td><a href='#none' onClick='refreshYearContent(\"prev\",_extPrevYear); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/left2-btn.gif' alt='' title='' /></a></td>"
	       +"<td><a href='#none' onClick='refreshYearContent(\"next\",_extNextYear); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/right2-btn.gif' alt='' title='' /></a></td>"
		   +"</tr>";
		startPos = yearPos;
		for(var i=0; i < 5; i++) {
		  	Year_HTML += "<tr>";
		  	Year_HTML += "<td><a href='#none' id='"+startPos+"' onClick='setYearCal("+startPos+","+yearPos+"); return false;'>"+startPos+"</a></td><td><a href='#none' id='"+(startPos+5)+"' onClick='setYearCal("+(startPos+5)+","+yearPos+"); return false;'>"+(startPos+5)+"</a></td>";
		  		+"<td><a href='#none' id='"+startPos+"' onClick='setYearCal("+startPos+","+yearPos+"); return false;'>"+startPos+"</a></td><td><a href='#none'  id='"+(startPos+5)+"' onClick='setYearCal("+(startPos+5)+","+yearPos+"); return false;'>"+(startPos+5)+"</a></td>";
		  	Year_HTML += "</tr>";
		  	startPos++;
		}
	} else { /* 이전 년도 버튼 클릭시 */
		_extNextYear = yearPos + 10;
		_extPrevYear = yearPos - 10;
		Year_HTML+="<td><a href='#none' onClick='refreshYearContent(\"prev\",_extPrevYear); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/left2-btn.gif' alt='' title='' /></a></td>"
	       +"<td><a href='#none' onClick='refreshYearContent(\"next\",_extNextYear); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/right2-btn.gif' alt='' title='' /></a></td>"
		   +"</tr>";
		startPos = yearPos - 9;
		for(var i=0; i < 5; i++) {
		  	Year_HTML += "<tr>";
		  	Year_HTML += "<td><a href='#none' id='"+startPos+"' onClick='setYearCal("+startPos+","+(yearPos-9)+"); return false;'>"+startPos+"</a></td><td><a href='#none' id='"+(startPos+5)+"' onClick='setYearCal("+(startPos+5)+","+(yearPos-9)+"); return false;'>"+(startPos+5)+"</a></td>";
		  		+"<td><a href='#none' id='"+startPos+"' onClick='setYearCal("+startPos+","+(yearPos-9)+"); return false;'>"+ startPos+"</a></td><td><a href='#none' id='"+(startPos+5)+"' onClick='setYearCal("+(startPos+5)+","+(yearPos-9)+"); return false;'>"+(startPos+5)+"</a></td>";
		  	Year_HTML += "</tr>";
		  	startPos++;
		}
	}
	year_Content.innerHTML = Year_HTML;
}

function closeCal(ev)
{
  var el = Calendar.is_ie ? Calendar.getElement(ev) : Calendar.getTargetElement(ev);
  for (; el != null; el = el.parentNode) {
    if (el.id == "calendar") break;
  }
  if (el == null) {
    document.getElementById('calendar').style.display ="none";closeShim( document.getElementById('calendar'));
    Calendar.removeEvent(document, "mousedown", closeCal);
  }

  _datefieldArr = new Array();
}

function closeMonCal(ev)
{
  var el = Calendar.is_ie ? Calendar.getElement(ev) : Calendar.getTargetElement(ev);
  for (; el != null; el = el.parentNode) {
    if (el.id == "calendarMt") break;
  }
  if (el == null) {
    document.getElementById('calendarMt').style.display ="none";closeShim( document.getElementById('calendarMt'));
    Calendar.removeEvent(document, "mousedown", closeMonCal);
  }

  _datefieldArr = new Array();
}

function doOver() {                 /* 마우스가 칼렌다위에 있으면 */
 var el = window.event.srcElement;
 cal_Day = el.title;

 if (cal_Day.length > 7) {          /* 날자 값이 있으면. */
  el.style.borderTopColor = el.style.borderLeftColor = "buttonhighlight";
  el.style.borderRightColor = el.style.borderBottomColor = "buttonshadow";
 }
}

function doClickMt(sYear, sMonth) {

	/* 월 선택했으면, */
	if(sYear != undefined && sMonth != undefined) {
		target.value = sYear + "-" + (sMonth < 10 ?'0'+sMonth:''+sMonth);
	} else {  /* 월 선택이 안되었다면 현재 년도와 월로 셋팅되도록. */
		var date = new Date();
		var today = date.getFullYear() + "-" + (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : ''+(date.getMonth()+1));
		target.value = today;
	}


	document.getElementById('calendarMt').style.display='none';      /* 화면에서 지움 */
	closeShim( document.getElementById('calendarMt'));

	/* 날짜 선택후 호출되는 함수 - 개발자가 함수를 구현하였을 경우에만 호출된다. */
	if(typeof(doCalendarLater) == 'function'){
		doCalendarLater();
	}

}

function doClick(date) {                /* 날자를 선택하였을 경우 */
	cal_Day = date;
	if (cal_Day != null && cal_Day.length > 7) {          /* 날자 값이있으면 */
		target.value=cal_Day;              /* 값 설정 */
		/* 날자 선택시 select에 값을 할당시킴 */

		var date = new Date();
		var today = date.getFullYear() + (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : ''+(date.getMonth()+1)) +
						(date.getDate() < 10 ? '0'+date.getDate() : ''+date.getDate());

		var tagetObj = eval( "document.getElementById(\""+target.name+"\")" );
		/* 현재날짜까지만 선택할수 있는 makeDateSelectBoxToday로 콤보박스를 생성시에는 tagetArryDate이 존재한다. */
		var tagetArryDate = eval( "document.getElementById(\""+target.name+"DateBoxType\")" );
		var yyObj = eval( "document.getElementById(\""+target.name+"_yy\")" );
		/* var tagetArryDate = eval("document.all."+target.name+"DateBoxType"); */
		/* var yyObj = eval("document.all."+target.name+"_yy"); */



		if(yyObj != undefined){
			var mmObj = eval( "document.getElementById(\""+target.name+"_mm\")" );
			var ddObj = eval( "document.getElementById(\""+target.name+"_dd\")" );

			var now = cal_Day.split("-");

			var maxYear = date.getFullYear();
			var maxMonth = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : (date.getMonth()+1));
			var maxDate = (date.getDate() < 10 ? '0'+date.getDate() : date.getDate());

			if(tagetArryDate != undefined  && tagetArryDate.value == "before" && parseInt(maxYear,10) <= parseInt(now[0],10)) {
				yyObj.value = maxYear;
				mmObj.value = maxMonth;
				ddObj.value = maxDate;

				/* 최초 달,일 로 셋팅되기 위해 사용한 변수. */
				monthValue = "";
				dateValue  = "";

				if(parseInt(maxMonth,10) < parseInt(now[1],10)) {
					monthValue = maxMonth;
					dateValue = maxDate;
				}else if(parseInt(maxMonth,10) == parseInt(now[1],10)) {
					monthValue = maxMonth;
					if(parseInt(maxDate,10) < parseInt(now[2],10)) {
						dateValue = maxDate;
					}else {
						dateValue = now[2];
					}
				}else {
					monthValue = now[1];
					dateValue = now[2];
				}
				mmObj.value = monthValue;
				ddObj.value = dateValue;
				onChangeLeapDatetoYear(yyObj,mmObj,ddObj,tagetObj,today);
				ddObj.value = dateValue;
			}else if(tagetArryDate != undefined  && tagetArryDate.value == "after" && parseInt(maxYear,10) >= parseInt(now[0],10)) {
				yyObj.value = maxYear;
				mmObj.value = maxMonth;
				ddObj.value = maxDate;

				if(parseInt(maxMonth,10) > parseInt(now[1],10)) {
					mmObj.value = maxMonth;
					ddObj.value = maxDate;
				}else if(parseInt(maxMonth,10) == parseInt(now[1],10)) {
					mmObj.value = maxMonth;
					if(parseInt(maxDate,10) > parseInt(now[2],10)) {
						ddObj.value = maxDate;
					}else {
						ddObj.value = now[2];
					}
				}else {
					mmObj.value = now[1];
					ddObj.value = now[2];
				}
				onChangeLeapDateAftertoYear(yyObj,mmObj,ddObj,tagetObj,today);
			}else if(tagetArryDate != undefined  && tagetArryDate.value == "period") {
				/* fromday, today 설정. */
				var fromday = eval( "document.getElementById('"+target.name+"fromday').value" );
				var today = eval( "document.getElementById('"+target.name+"today').value" );

				var yyObjMinValue = fromday.substring(0,4);
				var mmObjMinValue = fromday.substring(4,6);
				var ddObjMinValue = fromday.substring(6,8);

				var yyObjMaxValue = today.substring(0,4);
				var mmObjMaxValue = today.substring(4,6);
				var ddObjMaxValue = today.substring(6,8);
				var pickDay = now[0]+now[1]+now[2];
				/* 년도 비교 => 월 비교 => 일 비교 */
				if( fromday <= pickDay && today >= pickDay) {
					yyObj.value = now[0];
					mmObj.value = now[1];
					ddObj.value = now[2];
					onChangeLeapPeriodDatetoYear(yyObj,mmObj,ddObj,tagetObj,fromday,today);
				}
			}else if(tagetArryDate != undefined  && tagetArryDate.value == "after"){
				yyObj.value = now[0];
				mmObj.value = now[1];
				ddObj.value = now[2];
				onChangeLeapDateAftertoYear(yyObj,mmObj,ddObj,tagetObj);
			}else{
				yyObj.value = now[0];
				mmObj.value = now[1];
				ddObj.value = now[2];
				onChangeLeapDatetoYear(yyObj,mmObj,ddObj,tagetObj);
			}
		}
	}
	document.getElementById('calendar').style.display='none';      /* 화면에서 지움 */
	closeShim( document.getElementById('calendar'));

	/* 날짜 선택후 호출되는 함수 - 개발자가 함수를 구현하였을 경우에만 호출된다. */
	if(typeof(doCalendarLater) == 'function'){
		doCalendarLater();
	}
}

function doOut() {
 var el = window.event.fromElement;
 cal_Day = el.title;

 if (cal_Day.length > 7) {
  el.style.borderColor = "white";

 }

}

function day2(d) {                  /* 2자리 숫자료 변경 */
 var str = new String();
 if (parseInt(d,10) < 10) {
  str = "0" + parseInt(d,10);
 } else {
  str = "" + parseInt(d,10);
 }
 return str;
}

function Show_cal_period(nowday,fromday,today, chCalendar, isTodayBtn) {

 if(nowday < fromday) nowday = fromday;
 if(nowday > today) nowday = today;

 var Months_day = new Array(0,31,28,31,30,31,30,31,31,30,31,30,31);
 var Weekday_name = new Array("Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat");
 var Weekday_Display_name = new Array("Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat");
 var Month_name = null;
 if(language == "KO") {
 	Month_name =  new Array("1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월");
 } else {
 	Month_name =  new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");
 }
 var intThisYear = new Number(), intThisMonth = new Number(), intThisDay = new Number();
 var intFromYear = new Number(), intFromMonth = new Number(), intFromDay = new Number();
 var intToYear = new Number(), intToMonth = new Number(), intToDay = new Number();
 document.getElementById("calendar").innerHTML = "";
 datToday = new Date();             /*  현재 날자 설정 */

 nowday = nowday.toString();
 fromday = fromday.toString();
 today = today.toString();

 intThisYear = parseInt(nowday.substring(0,4),10);
 intThisMonth = parseInt(nowday.substring(4,6),10);
 intThisDay = parseInt(nowday.substring(6,8),10);

 intFromYear = parseInt(fromday.substring(0,4),10);
 intFromMonth = parseInt(fromday.substring(4,6),10);
 intFromDay = parseInt(fromday.substring(6,8),10);

 intToYear = parseInt(today.substring(0,4),10);
 intToMonth = parseInt(today.substring(4,6),10);
 intToDay = parseInt(today.substring(6,8),10);

 if (intThisYear == 0) intThisYear = datToday.getFullYear();    /*  값이 없을 경우 */
 if (intThisMonth == 0) intThisMonth = parseInt(datToday.getMonth())+1; /*  월 값은 실제값 보다 -1 한 값이 돼돌려 진다. */
 if (intThisDay == 0) intThisDay = datToday.getDate();


 switch(intThisMonth) {
  case 1:
    intPrevYear = intThisYear -1;
    intPrevMonth = 12;
    intNextYear = intThisYear;
    intNextMonth = 2;
    break;
  case 12:
    intPrevYear = intThisYear;
    intPrevMonth = 11;
    intNextYear = intThisYear + 1;
    intNextMonth = 1;
    break;
  default:
    intPrevYear = intThisYear;
    intPrevMonth = parseInt(intThisMonth) - 1;
    intNextYear = intThisYear;
    intNextMonth = parseInt(intThisMonth) + 1;
    break;
 }

 NowThisYear = datToday.getFullYear();          /*  현재 년 */
 NowThisMonth = datToday.getMonth()+1;          /*  현재 월 */
 NowThisDay = datToday.getDate();               /*  현재 일 */

 datFirstDay = new Date(intThisYear, intThisMonth-1, 1);      /*  현재 달의 1일로 날자 객체 생성(월은 0부터 11까지의 정수(1월부터 12월)) */
 intFirstWeekday = datFirstDay.getDay();        /*  현재 달 1일의 요일을 구함 (0:일요일, 1:월요일) */

 intSecondWeekday = intFirstWeekday;
 intThirdWeekday = intFirstWeekday;

 datThisDay = new Date(intThisYear, intThisMonth, intThisDay);    /*  넘어온 값의 날자 생성 */
 intThisWeekday = datThisDay.getDay();              /*  넘어온 날자의 주 요일 */

 varThisWeekday = Weekday_name[intThisWeekday];     /*  현재 요일 저장 */

 intPrintDay = 1;                /*  달의 시작 일자 */
 secondPrintDay = 1;
 thirdPrintDay = 1;

 Stop_Flag = 0;

 if ((intThisYear % 4)==0) {             /*  4년마다 1번이면 (사로나누어 떨어지면) */
  if ((intThisYear % 100) == 0) {
   if ((intThisYear % 400) == 0) {
    Months_day[2] = 29;
   }
  } else {
   Months_day[2] = 29;
  }
 }
 intLastDay = Months_day[intThisMonth];          /*  마지막 일자 구함 */
 Stop_flag = 0;

  var prevYear = intThisYear;
 var nextYear = intThisYear;
 var prevNextDay = "";
 if(intThisDay == intLastDay) {	prevNextDay = "1";	}
 else {prevNextDay = intThisDay;}

 var prevMonth = prevYear.toString() + ((intThisMonth - 1)<10?'0'+(intThisMonth - 1):''+(intThisMonth - 1))
 				+ (prevNextDay<10?'0'+prevNextDay:''+prevNextDay);
 var nextMonth = nextYear.toString() + ((intThisMonth + 1)<10?'0'+(intThisMonth + 1):''+(intThisMonth + 1))
                + (prevNextDay<10?'0'+prevNextDay:''+prevNextDay);

 if(intThisMonth == 1) {
 	prevYear = prevYear - 1;
 	prevMonth = prevYear.toString() + "12" + (prevNextDay<10?'0'+prevNextDay:''+prevNextDay);
 } else if (intThisMonth == 12) {
 	nextYear = nextYear + 1;
    nextMonth = nextYear.toString() + "01" + (prevNextDay<10?'0'+prevNextDay:''+prevNextDay);
 }

 	Cal_HTML = "<div class='month_chagne' tabIndex='0'>";

 	if(intFromMonth == intThisMonth && intFromYear == intThisYear) {
 		Cal_HTML +="<a href='#none'><img src='"+_calendar_img_root+"/img/common/calendar/left-btn.gif'  alt='이전달'  title='' class='calendar_left'/></a>";
 	} else {
 		Cal_HTML +="<a href='#none' onClick='Show_cal_period("+prevMonth+","+fromday+","+today+",\"USE\","+isTodayBtn+"); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/left-btn.gif'  alt='이전달'  title='' class='calendar_left'/></a>";
 	}

 	if(intToMonth == intThisMonth && intToYear == intThisYear) {
 		Cal_HTML +="<a href='#none'><img src='"+_calendar_img_root+"/img/common/calendar/right-btn.gif'  alt='다음달'  title='' class='calendar_right'/></a>";
 	} else {
 		Cal_HTML +="<a href='#none' onClick='Show_cal_period("+nextMonth+","+fromday+","+today+",\"USE\","+isTodayBtn+"); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/right-btn.gif'  alt='다음달'  title='' class='calendar_right'/></a>";
 	}

	Cal_HTML +="<p><b><a href='#none'  onclick='moveElement(\"yearCalendar\",0, 0, 25); return false;'>"+intThisYear+"."+(intThisMonth<10?'0'+intThisMonth:''+intThisMonth)+"</a></b></p>"
		+"</div>"
		+"<TABLE cellpadding='0' cellspacing='0'  class='table_calendar'>"
		+"<THEAD>"
		+"<TR>"
		+"<TH scope='col' class='Sunday'><SPAN>S</SPAN></TH>"
		+"<TH scope='col' class='Monday'><SPAN>M</SPAN></TH>"
		+"<TH scope='col' class='Tuesday'><SPAN>T</SPAN></TH>"
		+"<TH scope='col' class='Wednesday'><SPAN>W</SPAN></TH>"
		+"<TH scope='col' class='Thursday'><SPAN>T</SPAN></TH>"
		+"<TH scope='col' class='Friday'><SPAN>F</SPAN></TH>"
		+"<TH scope='col' class='Saturday'><SPAN>S</SPAN></TH>"
		+"</TR>"
		+"</THEAD>"
		+"<TBODY>";

	var clsStr = "";
	var calRowCnt =0;
	var theDate = "";

	var prevMonLastDay = Months_day[(intThisMonth==1)?11:intThisMonth-1];
	var prevMonPrevPos = "";
	if(intThirdWeekday == 0) {
		prevMonPrevPos = prevMonLastDay - 6;
	} else {
		prevMonPrevPos = prevMonLastDay - (intThirdWeekday-1);
	}
	var weekLength = 7;
	if(intThirdWeekday == 0) {
		Cal_HTML += "<TR>";
		for (intLoopDay=1; intLoopDay <= 7; intLoopDay++) {
			Cal_HTML += "<TD ";
			if(intLoopDay == 1) {
				Cal_HTML += "class='sun'>"
				         + "<a href='#none' class='prevday'>"+prevMonPrevPos+"</a></TD>";
	 	 	} else {
	 	 		Cal_HTML += "><a href='#none' class='prevday'>"+prevMonPrevPos+"</a></TD>";
	 	 	}
			prevMonPrevPos++;
	 	 	intThirdWeekday--;
		}
 	 	Cal_HTML += "</TR>";
 	 	weekLength = 6;
	}
	for (intLoopWeek=1; intLoopWeek < weekLength; intLoopWeek++) {      /*  주단위 루프 시작, 최대 6주 */
	 	Cal_HTML += "<TR>";
		for (intLoopDay=1; intLoopDay <= 7; intLoopDay++) {       /*  요일단위 루프 시작, 일요일 부터 */
			clsStr = "";
			theDate = intThisYear+""+day2(intThisMonth).toString()+day2(thirdPrintDay).toString();
			if (intThirdWeekday > 0) {           /*  첫주 시작일이 1보다 크면 */
				Cal_HTML += "<TD ";
				if(intLoopDay == 1) {
					Cal_HTML += "class='sun'>"
					         + "<a href='#none' class='prevday'>"+prevMonPrevPos+"</a></td>";
		 	 	} else {
		 	 		Cal_HTML += "><a href='#none' class='prevday'>"+prevMonPrevPos+"</a></td>";
		 	 	}
				prevMonPrevPos++;
		 	 	intThirdWeekday--;
			} else {
			    if (thirdPrintDay > intLastDay) {        /*  입력 날짝 월말보다 크다면 */
		 	 		Cal_HTML += "<td>";
		 	 			Cal_HTML += "<a href='#none' class='nextday'>" + (thirdPrintDay-intLastDay)+"</a></td>";
			    } else {
			    	/*
			    		입력날짜가 현재월에 해당 되면
			    	       공휴일 temp에 해당일이 존재하는지 체크 - 존재하면 링크없앰
			    	*/
			    	var isHolidayCheck = "";
			    	if(_holidayArr.length > 0){
				    	isHolidayCheck = isHolidayCheckFunction(intThisYear+""+day2(intThisMonth).toString()+day2(thirdPrintDay).toString());
			    	}
			    	/* 기간이 정해진 사항이면 */
					if(theDate >= fromday && theDate <= today ) {
		     			switch(intLoopDay) {
							case 1:             /*  일요일이면 빨간 색으로 */
							if(isHolidayCheck == "Y"){/* 휴일 */
		      						Cal_HTML += "<TD class=' x-date-disabled' title='"+busienssErrMsg+"'>";
		      					} else {
									Cal_HTML += "<TD class = 'sun'>";
		      					}
								break;
							case 7:
								if(isHolidayCheck == "Y"){/* 휴일 */
		      						Cal_HTML += "<TD class=' x-date-disabled' title='"+busienssErrMsg+"'>";
		      					} else {
									Cal_HTML += "<TD class = 'sat'>";
		      					}
								break;
		      				default:
		      					if(isHolidayCheck == "Y"){/* 휴일 */
		      						Cal_HTML += "<TD  class = ' x-date-disabled'>";
		      					} else if(thirdPrintDay == NowThisDay) {
									Cal_HTML += "<TD class='today'>";
								} else {
									Cal_HTML += "<TD>";
								}
		       					break;
		     			}
						if(isHolidayCheck == "Y"){	/* 휴일 */
							Cal_HTML +=  "<em><a href='#none' class='x-date-date'>"+thirdPrintDay+"</a></em>" ;
						}else{	/*  영업일 */
							if(thirdPrintDay == NowThisDay) {
								Cal_HTML += "<a href='#none' alt="+intThisYear+"-"+day2(intThisMonth).toString()+"-"+day2(thirdPrintDay).toString()+" "
								 + " onClick='doClick(\"" + intThisYear+"-"+day2(intThisMonth).toString()+"-"+day2(thirdPrintDay).toString()+ "\"); return false;'><B>"+thirdPrintDay + "</B></a>";/* firefox에선 cursor:hand단독으로 사용하면 안됨 */

							} else {
								Cal_HTML += "<a href='#none' alt="+intThisYear+"-"+day2(intThisMonth).toString()+"-"+day2(thirdPrintDay).toString()+" "
								 +" onClick='doClick(\"" + intThisYear+"-"+day2(intThisMonth).toString()+"-"+day2(thirdPrintDay).toString()+ "\"); return false;'>"+thirdPrintDay + "</a>";/* firefox에선 cursor:hand단독으로 사용하면 안됨 */

							}
						}
					} else{
						Cal_HTML +=  "<TD title='' class=' x-date-disabled'><a href='#none'>"+thirdPrintDay+"</a></TD>" ;
					}
	    		}
			    thirdPrintDay++;
		   	}
	   		Cal_HTML += "</TD>";
	  	}/* end for */
	  	Cal_HTML += "</TR>";
		calRowCnt ++;
	  	if (Stop_Flag==1) break;
	 }/* end for */

	 Cal_HTML += "</TBODY></TABLE>";

	 /*  바닥에 today 버튼 생성 */
	 if(isTodayBtn) {
		 Cal_HTML += "<div class='text_center mar_t2'>"
	              +"<a class='btn_tbl_func_a btn_sys1' href='#none' onClick='doClick(\"" + NowThisYear+"-"+day2(NowThisMonth.toString())+"-"+day2(NowThisDay.toString())+ "\"); return false;'  ><span>Today</span></a>"
	              +"</div>";
	 }
	  /*  달력 상단 가운데에  달 선택하는 부분 */
	  Cal_HTML +="<div class='year_calendar' id='yearCalendar' style='top:-160px;'>"
	 		  +"<div class='clear'>";

	 /*  Year */
	  Cal_HTML +="<div id='year_Content'><table cellspacing='0' width='90'>"
		      +"<tbody><tr><th colspan='2'>Year</th> </tr>"
		      +"<tr>"
		      +"<td><a href='#none' onClick='refreshYearFromToContent(\"prev\",NowThisYear-5"+","+fromday+","+today+"); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/left2-btn.gif' alt='' title='' /></a></td>"
		      +"<td><a href='#none' onClick='refreshYearFromToContent(\"next\",NowThisYear+6"+","+fromday+","+today+"); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/right2-btn.gif' alt='' title='' /></a></td>"
		      +"</tr>";


	  /* 현재 년도 기준으로 -4 +5년 셋팅 */
	  for(var i=NowThisYear-4; i <= NowThisYear; i++) {
	  	Cal_HTML += "<tr>";
	  	if(i == NowThisYear) {
	  		Cal_HTML += "<td><a href='#none' id='"+i+"' onClick='setYearCal("+i+",NowThisYear-4); return false;' class='here'>"+ i+"</a></td><td><a href='#none' id='"+(i+5)+"' onClick='setYearCal("+(i+5)+",NowThisYear-4); return false;'>"+(i+5)+"</a></td>";
	  	} else {
	  		Cal_HTML += "<td><a href='#none' id='"+i+"' onClick='setYearCal("+i+",NowThisYear-4); return false;'>"+ i+"</a></td><td><a href='#none' id='"+(i+5)+"' onClick='setYearCal("+(i+5)+",NowThisYear-4); return false;'>"+(i+5)+"</a></td>";
	  	}
	  	Cal_HTML += "</tr>";
	  }

	  Cal_HTML += "</tbody></table></div>";


	 /*  Month */
	  Cal_HTML +="<table cellspacing='0' width='72'>"
	 		  +"<tbody>"
	 		  +"<tr><th colspan='2'>Month</th></tr>";

	  for(var i=0; i < 6; i++) {
	 	Cal_HTML +="<tr>";
		if(i==(NowThisMonth-1)){
			Cal_HTML += "<td><a href='#none' id='"+i+"' onClick='setMonthCal("+i+"); return false;' class='here'>"+Month_name[i]+"</a></td>";
		} else {
			Cal_HTML += "<td><a href='#none' id='"+i+"' onClick='setMonthCal("+i+"); return false;'>"+Month_name[i]+"</a></td>";
		}

		if(i+6==(NowThisMonth-1)){
			Cal_HTML += "<td><a href='#none' id='"+(i+6)+"' onClick='setMonthCal("+(i+6)+"); return false;' class='here'>"+Month_name[i+6]+"</a></td>";
		} else {
			Cal_HTML += "<td><a href='#none' id='"+(i+6)+"' onClick='setMonthCal("+(i+6)+"); return false;'>"+Month_name[i+6]+"</a></td>";
		}

	 	Cal_HTML +="</tr>";
	  }

	 Cal_HTML +="</tbody></table>";

	  Cal_HTML += "</div>"; /* clear div 닫음! */
	  if(language == "KO") {
	  Cal_HTML += "<div class='text_center mar_t12'>"
	 		  + "<a class='btn_tbl_func_a btn_sys1' href='#none' onclick='goChangeValueShowFromTo_Cal("+fromday+","+today+","+isTodayBtn+"); return false;'> <span>확인</span></a>"
	 		  + "<a class='btn_tbl_func_a btn_sys1' href='#none' onclick='moveElement(\"yearCalendar\",0, -160, 0); return false;'> <span>취소</span></a>"
	 		  + "</div>";
	  } else {
		  Cal_HTML += "<div class='text_center mar_t12'>"
	 		  + "<a class='btn_tbl_func_a btn_sys1' href='#none' onclick='goChangeValueShowFromTo_Cal("+fromday+","+today+","+isTodayBtn+"); return false;'> <span>Confirm</span></a>"
	 		  + "<a class='btn_tbl_func_a btn_sys1' href='#none' onclick='moveElement(\"yearCalendar\",0, -160, 0); return false;'> <span>Cancel</span></a>"
	 		  + "</div>";
	  }
	 Cal_HTML += "</div>"; /*  year_calendar div 닫음! */

	 /* Cal_HTML += "<tr class=bot><td colspan=7></td></tr></TABLE>"; */
	 Cal_HTML += "</tbody></table>";

	 /*  영업일 체크->  달력 생성-> 화면 보여지기 순으로 보여주기 위함 ( chCalendar 가 USE인것은 달력내에서 이전 다음달 클릭시임) */
	 if(chCalendar == "USE"){
	 	document.getElementById('calendar').style.display ="block";
	 	openShim(document.getElementById('calendar'),null);
	 }else{
	 	 if(document.getElementById('calendar').style.display == "block") {
	 	 	document.getElementById('calendar').style.display ="none";
	 	 	closeShim(document.getElementById('calendar'));
	 	 }else{
	 	 	document.getElementById('calendar').style.display ="block";
	 	 	openShim(document.getElementById('calendar'),null);
	 	 }
	 }
	 document.getElementById("calendar").innerHTML = Cal_HTML;
	 document.getElementById("calendar").focus();

	/* 변수 초기화 */
	 calInit();
}

/*  달,년도 선택 레이어에서 값 선택하고 확인 버튼 불렀을시 호출 */
function goChangeValueShowFromTo_Cal(fromday, today, isTodayBtn) {
	if(_extYearLayer == undefined || _extYearLayer == "") {
		_extYearLayer = NowThisYear;
	}
	if(_extMonthLayer == undefined || _extMonthLayer == "") {
		_extMonthLayer = NowThisMonth;
	}

	var _selDate = _extYearLayer.toString() + (_extMonthLayer.toString() >= 10 ? ""+_extMonthLayer.toString():"0"+_extMonthLayer.toString())
	+ (NowThisDay.toString() >= 10 ? ""+NowThisDay.toString():"0"+NowThisDay.toString());


	if(_selDate < fromday || _selDate > today) {
		Calendar.removeEvent(document, "mousedown", closeCal);
	 	if(language == "KO") {
		  i18nExtAlertFn("날짜의 범위를 벗어났습니다. <br/> [" + fromday.toString().substring(0,4) +
		    "-" + fromday.toString().substring(4,6) + "-" + fromday.toString().substring(6,8) +
		  	" ~ " + today.toString().substring(0,4) + "-" + today.toString().substring(4,6) +
		  	"-" + today.toString().substring(6,8) + "]", "",  showPeriodCalendar);
		} else {
		  i18nExtAlertFn("Out of vaild range of period <br/> [" + fromday.toString().substring(0,4) +
		  "-" + fromday.toString().substring(4,6) + "-" + fromday.toString().substring(6,8) +
		  " ~ " + today.toString().substring(0,4) + "-" + today.toString().substring(4,6) +
		  "-" + today.toString().substring(6,8) + "]", "",  showPeriodCalendar, "", language);
		}
//	 }  if(_selDate > today) {
//	 	Calendar.removeEvent(document, "mousedown", closeCal);
//	 	if(language == "KO") {
//		  i18nExtAlertFn("날짜의 범위를 벗어났습니다. <br/> [" + fromday.toString().substring(0,4) +"-" + fromday.toString().substring(4,6) + "-" + fromday.toString().substring(6,8) + " ~ " + today.toString().substring(0,4) + "-" + today.toString().substring(4,6) + "-" + today.toString().substring(6,8) + "]", "",  showPeriodCalendar);
//		} else {
//		  i18nExtAlertFn("Out of vaild range of period <br/> [" + fromday.toString().substring(0,4) +"-" + fromday.toString().substring(4,6) + "-" + fromday.toString().substring(6,8) + " ~ " + today.toString().substring(0,4) + "-" + today.toString().substring(4,6) + "-" + today.toString().substring(6,8) + "]", "",  showPeriodCalendar);
//		}
	 }

	 Show_cal_period(_selDate,fromday,today,'USE', isTodayBtn);
	 moveElement('yearCalendar',0, -160, 0);

}

function showPeriodCalendar(btn) {
	if(btn == '확인' || btn == 'ok'){
		Calendar.addEvent(document, "mousedown", closeCal);
	}
}

function refreshYearFromToContent(type, yearPos, fromday, today){
	var Year_HTML = "<table cellspacing='0' width='90'>"
	      +"<tbody><tr><th colspan='2'>Year</th> </tr>"
	      +"<tr>";
	var startPos = "";
	if(type == 'next') { /*  다음년도 버튼 클릭시 */
		_extNextYear = yearPos + 10;
		_extPrevYear = yearPos - 1;
		Year_HTML+="<td><a href='#none' onClick='refreshYearFromToContent(\"prev\",_extPrevYear,"+fromday+","+today+"); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/left2-btn.gif' alt='' title='' /></a></td>"
	       +"<td><a href='#none' onClick='refreshYearFromToContent(\"next\",_extNextYear,"+fromday+","+today+"); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/right2-btn.gif' alt='' title='' /></a></td>"
		   +"</tr>";
		startPos = yearPos;
		for(var i=0; i < 5; i++) {
		  	Year_HTML += "<tr>";
		  	Year_HTML += "<td><a href='#none' id='"+startPos+"' onClick='setYearCal("+startPos+","+yearPos+"); return false;'>"+startPos+"</a></td><td><a href='#none' id='"+(startPos+5)+"' onClick='setYearCal("+(startPos+5)+","+yearPos+"); return false;'>"+(startPos+5)+"</a></td>";
		  		+"<td><a href='#none' id='"+startPos+"' onClick='setYearCal("+startPos+","+yearPos+"); return false;'>"+startPos+"</a></td><td><a href='#none'  id='"+(startPos+5)+"' onClick='setYearCal("+(startPos+5)+","+yearPos+"); return false;'>"+(startPos+5)+"</a></td>";
		  	Year_HTML += "</tr>";
		  	startPos++;
		}
	} else { /*  이전 년도 버튼 클릭시 */
		_extNextYear = yearPos + 10;
		_extPrevYear = yearPos - 10;
		Year_HTML+="<td><a href='#none' onClick='refreshYearFromToContent(\"prev\",_extPrevYear); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/left2-btn.gif' alt='' title='' /></a></td>"
	       +"<td><a href='#none' onClick='refreshYearFromToContent(\"next\",_extNextYear); return false;'><img src='"+_calendar_img_root+"/img/common/calendar/right2-btn.gif' alt='' title='' /></a></td>"
		   +"</tr>";
		startPos = yearPos - 9;
		for(var i=0; i < 5; i++) {
		  	Year_HTML += "<tr>";
		  	Year_HTML += "<td><a href='#none' id='"+startPos+"' onClick='setYearCal("+startPos+","+(yearPos-9)+"); return false;'>"+startPos+"</a></td><td><a href='#none' id='"+(startPos+5)+"' onClick='setYearCal("+(startPos+5)+","+(yearPos-9)+"); return false;'>"+(startPos+5)+"</a></td>";
		  		+"<td><a href='#none' id='"+startPos+"' onClick='setYearCal("+startPos+","+(yearPos-9)+"); return false;'>"+ startPos+"</a></td><td><a href='#none' id='"+(startPos+5)+"' onClick='setYearCal("+(startPos+5)+","+(yearPos-9)+"); return false;'>"+(startPos+5)+"</a></td>";
		  	Year_HTML += "</tr>";
		  	startPos++;
		}
	}
	year_Content.innerHTML = Year_HTML;
}

/*  Objec t 우선순위 문제로 div 가려지는 현상 debug를 위한 추가 소스 */
function openShim(menu,menuItem)
{
    if (menu==null) return;
    var shim = getShim(menu);
    if (shim==null) shim = createMenuShim(menu,getShimId(menu));

    /* Change menu zIndex so shim can work with it */
    menu.style.zIndex = 10000;

    var width = menu.offsetWidth;
    var height;

    var height = menu.offsetHeight;

    shim.style.width = width;
    shim.style.height = height;
    shim.style.top = menu.style.top;
    shim.style.left = menu.style.left;
    shim.style.zIndex = menu.style.zIndex - 1;
    shim.style.position = "absolute";
    shim.style.display = "block";
}

/* Closes the shim associated with the menu */
function closeShim(menu)
{
    if (menu==null) return;
    var shim = getShim(menu);
    if (shim!=null) shim.style.display = "none";

    _datefieldArr = new Array();
}

/* Creates a new shim for the menu */
function createMenuShim(menu)
{
    if (menu==null) return null;
/*
    var shim = document.createElement("<iframe scrolling='no' frameborder='0'"+
                                      "style='position:absolute; top:0px;"+
                                      "left:0px; display:none'></iframe>");
*/

     var shim = document.createElement('iframe');
     shim.setAttribute('scrolling','no',0);
     shim.setAttribute('frameborder','0',0);
     shim.setAttribute('style','position:absolute; top:0px;left:0px; display:none',0);

    shim.name = getShimId(menu);
    shim.id = getShimId(menu);
    /*
    	Unremark this line if you need your menus to be transparent for some reason
    	shim.style.filter="progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)";
    */

    if (menu.offsetParent==null || menu.offsetParent.id=="")
    {
        window.document.body.appendChild(shim);
    }
    else
    {
        menu.offsetParent.appendChild(shim);
    }

    return shim;
}

/* Creates an id for the shim based on the menu id */
function getShimId(menu)
{
    if (menu.id==null) return "__shim";
    return "__shim"+menu.id;
}

/* Returns the shim for a specific menu */
function getShim(menu)
{
    return document.getElementById(getShimId(menu));
}

function getMenuItemCount(menu)
{
    var count = 0;
    var child = menu.firstChild;

    while (child)
    {
        if (child.nodeName=="DIV") count = count + 1;
        child = child.nextSibling;
    }
    return count;
}


/**
 * 해당 년,월에 맞는 일자 셀렉트 박스의 옵션 생성.
 * <br>ex : onChangeLeapDate(form1.year,form1.month,form1.date)
 * @param year : 년도 정보를 가지고 있는 객체의 form이름.객체이름
 * @param month : 월 정보를 가지고 있는 객체의 form이름.객체이름
 * @param date : 일 정보를 가지고 있는 객체의 form이름.객체이름
 * @param target : 년,월,일이 들어갈 target input box의   name
 * @param today : 8자리 현재 날짜. ex>20080402
 */
function onChangeLeapDate(year,month,date,target,today) {
	var i = 1;
	var k = 1;
	date.length = findLeapEndDate(year.value, month.value);
	/* month.length = 12; */

	if(today !=undefined) {

		var nYear = today.substring(0,4);
		var nMonth = today.substring(4,6);
		var nDate = today.substr(6);

		if(year.value == nYear && month.value == nMonth) {
			date.length = parseInt(nDate,10);
		}
		if(year.value == nYear) {
			month.length = parseInt(nMonth,10);
		}else {
			month.length = 12;
		}
	}

	var total_month = month.length;
	for(i=1 ; i <= total_month; i++) {
		k = i;
		if(i < 10) k = '0' + k;
		month.options[i-1].text = k;
		month.options[i-1].value = k;
	}

	k=1;
	if(date.length !=undefined) {
	  	var total_days = (date.length != undefined) ? date.length:1;
		for (i=1 ;i <= total_days;i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[i-1].text=k;
			date.options[i-1].value=k;
		}

		/* 후달로 갈경우는 그달의 1일로 세팅. 전달로 갈경우는 같은 날짜로 세팅. */
		if(year.value + month.value  > rmDate(target.value).substring(0,6)) {
			date.options[0].selected = true;
		}else{
			/* 만약 이전달에 해당 일이 없으면 첫 날짜로 세팅. */
			if((date.options[0].value <= rmDate(target.value).substring(6,8)) && (date.options[date.options.length-1].value >= rmDate(target.value).substring(6,8)) ) {
				date.value =  rmDate(target.value).substring(6,8);
			}else{
				date.options[0].selected = true;
			}
		}

		if(year.value + month.value  > rmDate(target.value).substring(0,6)) {
			/* 만약 이후달로 이동시 해당일이 없을 경우 그 월의 마지막 일로 선택. */
			if((date.options[0].value <= rmDate(target.value).substring(6,8)) &&
					(date.options[date.options.length-1].value >= rmDate(target.value).substring(6,8)) ) {
				date.value =  rmDate(target.value).substring(6,8);
			}else{
				date.options[date.options.length-1].selected = true;
			}
		}else{
			/* 만약 이전달에 해당 일이 없으면 첫 날짜로 세팅. */
			if((date.options[0].value <= rmDate(target.value).substring(6,8)) &&
					(date.options[date.options.length-1].value >= rmDate(target.value).substring(6,8))) {
				date.value =  rmDate(target.value).substring(6,8);
			}else{
				var monthLastDay = findLeapEndDate(rmDate(target.value).substring(0,4),rmDate(target.value).substring(4,6));
				/* 현재일이 말일이고  시작일보다 선택값이 큰 경우는  말일로 세팅(말일일 경우) 그외는  첫 값으로 세팅함. */
				if(monthLastDay == rmDate(target.value).substring(6,8) ){
					date.options[date.options.length-1].selected = true;
				}else{
					date.options[0].selected = true;
				}
			}
		}

	}
	onChangeDate(year,month,date,target);

}

function onChangeLeapDatetoYear(year,month,date,target,today) {
	var i = 1;
	var k = 1;
	date.length = findLeapEndDate(year.value, month.value);
	/* month.length = 12; */

	if(today !=undefined) {

		var nYear = today.substring(0,4);
		var nMonth = today.substring(4,6);
		var nDate = today.substr(6);

		if(year.value == nYear && month.value == nMonth) {
			date.length = parseInt(nDate,10);
		}
		if(year.value == nYear) {
			month.length = parseInt(nMonth,10);
		}else {
			month.length = 12;
		}
	}

	var total_month = month.length;
	for(i=1 ; i <= total_month; i++) {
		k = i;
		if(i < 10) k = '0' + k;
		month.options[i-1].text = k;
		month.options[i-1].value = k;
	}

	k=1;
	if(date.length !=undefined) {
	  	var total_days = (date.length != undefined) ? date.length:1;
		for (i=1 ;i <= total_days;i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[i-1].text=k;
			date.options[i-1].value=k;
		}
	}
	if(target != undefined) {
		if(year.value > target.value.substring(0,4)) {
		    /* 만약 이후년으로 이동시 해당월이 없을 경우 그 해의 마지막 월로 선택. */
			if((month.options[0].value <= rmDate(target.value).substring(4,6)) && (month.options[month.options.length-1].value >= rmDate(target.value).substring(4,6)) ) {
				month.value = rmDate(target.value).substring(4,6);
			}else{
				month.options[month.options.length-1].selected = true;
			}
		}else{
			/* 만약 이전년에 해당 월이 없으면 첫 월로 세팅. */
			if((month.options[0].value <= rmDate(target.value).substring(4,6)) && (month.options[month.options.length-1].value >= rmDate(target.value).substring(4,6)) ) {
				month.value = rmDate(target.value).substring(4,6);
			}else{
				month.options[0].selected = true;
			}
		}
	}
	onChangeLeapDate(year,month,date,target,today);
}

/**
 * 금일 이후로 날짜를 조회하는 달력 스크립트
 * <br>ex : onChangeLeapDateAfter(form1.year,form1.month,form1.date)
 * @param year : 년도 정보를 가지고 있는 객체의 form이름.객체이름
 * @param month : 월 정보를 가지고 있는 객체의 form이름.객체이름
 * @param date : 일 정보를 가지고 있는 객체의 form이름.객체이름
 * @param target : 년,월,일이 들어갈 target input box의   name
 * @param today : 8자리 현재 날짜. ex>20080402
 */
function onChangeLeapDateAfter(year,month,date,target,today) {

	var i = 1;
	var k = 1;
	date.length = findLeapEndDate(year.value, month.value);
	month.length = 12;
	if(today !=undefined) {
		var nYear = today.substring(0,4);
		var nMonth = today.substring(4,6);
		var nDate = today.substr(6);
	}

	if(year.value == nYear) {
		month.length = month.length - parseInt(nMonth,10)+1;
		var total_month = month.length;
		var monthValue = nMonth.charAt(0) == '0' ? parseInt(nMonth.substring(1,2),10) : parseInt(nMonth,10);
		for(i=1 ; i <= total_month; i++) {
			k = i+monthValue-1;
			if(k < 10) k = '0' + k;
			month.options[i-1].text = k;
			month.options[i-1].value = k;
		}
	}else {
		var total_month = month.length;
		for(i=1 ; i <= total_month; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[i-1].text = k;
			month.options[i-1].value = k;
		}
	}

	if(year.value == nYear && month.value == nMonth) {
		date.length = date.length - parseInt(nDate,10)+1;
		k=1;
	  	var total_days = date.length;
	  	var dateValue = nDate.charAt(0) == '0' ? parseInt(nDate.substring(1,2),10) : parseInt(nDate,10);
		for (i=1 ;i <= total_days;i++) {
			k = i+dateValue-1;
			if(k < 10) k = '0' + k;
			date.options[i-1].text=k;
			date.options[i-1].value=k;
		}
	}else{
		k=1;
	  	var total_days = date.length;
		for (i=1 ;i <= total_days;i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[i-1].text=k;
			date.options[i-1].value=k;
		}
	}

	if(year.value + month.value  > rmDate(target.value).substring(0,6)) {
		/* 만약 이후달로 이동시 해당일이 없을 경우 그 월의 마지막 일로 선택. */
		if((date.options[0].value <= rmDate(target.value).substring(6,8)) &&
				(date.options[date.options.length-1].value >= rmDate(target.value).substring(6,8))) {
			date.value =  rmDate(target.value).substring(6,8);
		}else{
			date.options[date.options.length-1].selected = true;
		}
	}else{
		/* 만약 이전달에 해당 일이 없으면 첫 날짜로 세팅. */
		if((date.options[0].value <= rmDate(target.value).substring(6,8)) &&
				(date.options[date.options.length-1].value >= rmDate(target.value).substring(6,8)) &&
					today <= year.value + month.value + date.value) {
			date.value =  rmDate(target.value).substring(6,8);
		}else{
			var monthLastDay = findLeapEndDate(rmDate(target.value).substring(0,4),rmDate(target.value).substring(4,6));
			/* 현재일이 말일이고  시작일보다 선택값이 큰 경우는  말일로 세팅(말일일 경우) 그외는  첫 값으로 세팅함. */
			if(monthLastDay == rmDate(target.value).substring(6,8) && today.substring(0,6) < year.value + month.value){
				date.options[date.options.length-1].selected = true;
			}else{
				date.options[0].selected = true;
			}
		}
	}
	onChangeDate(year,month,date,target);
}

function onChangeLeapDateAftertoYear(year,month,date,target,today) {

	var i = 1;
	var k = 1;
	date.length = findLeapEndDate(year.value, month.value);
	month.length = 12;
	if(today !=undefined) {
		var nYear = today.substring(0,4);
		var nMonth = today.substring(4,6);
		var nDate = today.substr(6);
	}

	if(year.value == nYear) {
		month.length = month.length - parseInt(nMonth,10)+1;
		var total_month = month.length;
		var monthValue = nMonth.charAt(0) == '0' ? parseInt(nMonth.substring(1,2),10) : parseInt(nMonth,10);
		for(i=1 ; i <= total_month; i++) {
			k = i+monthValue-1;
			if(k < 10) k = '0' + k;
			month.options[i-1].text = k;
			month.options[i-1].value = k;
		}
	}else {
		var total_month = month.length;
		for(i=1 ; i <= total_month; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[i-1].text = k;
			month.options[i-1].value = k;
		}
	}

	if(year.value == nYear && month.value == nMonth) {
		date.length = date.length - parseInt(nDate,10)+1;
		k=1;
	  	var total_days = date.length;
	  	var dateValue = nDate.charAt(0) == '0' ? parseInt(nDate.substring(1,2),10) : parseInt(nDate,10);
		for (i=1 ;i <= total_days;i++) {
			k = i+dateValue-1;
			if(k < 10) k = '0' + k;
			date.options[i-1].text=k;
			date.options[i-1].value=k;
		}
	}else{
		k=1;
	  	var total_days = date.length;
		for (i=1 ;i <= total_days;i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[i-1].text=k;
			date.options[i-1].value=k;
		}
	}

	if(year.value > target.value.substring(0,4)) {
		 /* 만약 이후년으로 이동시 해당월이 없을 경우 그 해의 마지막 월로 선택. */
		if((month.options[0].value <= rmDate(target.value).substring(4,6)) && (month.options[month.options.length-1].value >= rmDate(target.value).substring(4,6)) ) {
			month.value = rmDate(target.value).substring(4,6);
		}else{
			month.options[month.options.length-1].selected = true;
		}
	}else{
		/* 만약 이전년에 해당 월이 없으면 첫 월로 세팅. */
		if((month.options[0].value <= rmDate(target.value).substring(4,6)) && (month.options[month.options.length-1].value >= rmDate(target.value).substring(4,6)) ) {
			month.value = rmDate(target.value).substring(4,6);
		}else{
			month.options[0].selected = true;
		}
	}

	onChangeLeapDateAfter(year,month,date,target,today);
}
/**
 * 기간선택 달력일경우 해당 년,월에 맞는 일자 셀렉트 박스의 옵션 생성.
 * <br>ex : onChangeLeapDate(form1.year,form1.month,form1.date)
 * @param year : 년도 정보를 가지고 있는 객체의 form이름.객체이름
 * @param month : 월 정보를 가지고 있는 객체의 form이름.객체이름
 * @param date : 일 정보를 가지고 있는 객체의 form이름.객체이름
 * @param target : 년,월,일이 들어갈 target input box의   name
 * @param fromday : 8자리 현재 날짜. ex>20080402
 * @param today : 8자리 현재 날짜. ex>20080402
 */
function onChangeLeapPeriodDate(year,month,date,target,fromDay,toDay) {
	var i = 1;
	var k = 1;
	var cnt = 0;

	date.length = findLeapEndDate(year.value, month.value);

	fromDay = fromDay + "";
	toDay	= toDay   + "";

	var preValue = month.options[month.selectedIndex].value;

	var sYear = fromDay.substring(0,4);
	var sMonth = parseInt(fromDay.substring(4,6),10);
	var sDate = parseInt(fromDay.substring(6,8),10);
	var eYear  = toDay.substring(0,4);
	var eMonth = parseInt(toDay.substring(4,6),10);
	var eDate  = parseInt(toDay.substring(6,8),10);

	/* 선택한 연도가  끝연도 보다 작으며 선택한 연도가 시작연도 보다 클경우 시작연도보다 끝연도가 클경우(month가 1~12) */
	if(	year.value < eYear && year.value > sYear && sYear < eYear ) {
		month.length = 12;
		for(i=1 ; i <= 12; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[cnt].text = k;
			month.options[cnt++].value = k;
			if(preValue == k) month.selectedIndex = cnt-1;
		}
	/* 선택한 연도가  끝연도 보다 작으며 선택한 연도가 시작연도와 같을경우 시작연도보다 끝연도가 클경우(month가 sMonth ~12) */
	}else if( year.value < eYear && year.value == sYear && sYear < eYear ){
		month.length = 13 - sMonth;
		for(i=sMonth ; i <= 12; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[cnt].text = k;
			month.options[cnt++].value = k;
			if(preValue == k) month.selectedIndex = cnt-1;
		}
	/* 선택한 연도가  마지막 연도, 시작연도와 끝연도가 같은 경우 ( 1 ~ eMonth ) */
	}else if( year.value == eYear && sYear != eYear){
		month.length = eMonth;
		for(i=1 ; i <= eMonth; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[cnt].text = k;
			month.options[cnt++].value = k;
			if(preValue == k) month.selectedIndex = cnt-1;
		}
	/* 선택한 연도가  마지막 연도, 시작연도와 끝연도가 같은 경우 ( sMonth ~ eMonth ) */
	}else if( (year.value == eYear && sYear == eYear) ){
		month.length = eMonth-sMonth + 1;
		for(i=sMonth ; i <= eMonth; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[cnt].text = k;
			month.options[cnt++].value = k;
			if(preValue == k) month.selectedIndex = cnt-1;
		}
	}else{
		/* 이전 연도가 크면 오류? 아니면 값을 바꿔주는 처리. */
		alert("날짜를 다시 입력하세요.");
	}
	month.options[month.selectedIndex].selected = true;

	k=1;
  	var total_days = (date.length != undefined) ? date.length:1;
  	cnt = 0;
  	/* 최초 시작달일경우.. */
	if(year.value == sYear && month.value == sMonth) {
		if(total_days == findLeapEndDate(year.value, month.value)) {
			date.length = total_days - sDate +1;
		}else {
			date.length = total_days;
		}
		for (i=sDate ;i <= findLeapEndDate(year.value, month.value);i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[cnt].text=k;
			date.options[cnt++].value=k;
		}

	/* 마지막 달일경우.. */
	}else if(year.value == eYear && month.value == eMonth) {
		if(eDate > total_days) eDate = total_days;
		date.length = eDate;
		for (i=1 ;i <= eDate ;i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[cnt].text=k;
			date.options[cnt++].value=k;
		}
	}else {
		for (i=1 ;i <= total_days;i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[i-1].text=k;
			date.options[i-1].value=k;
		}
	}

	if(year.value + month.value  > rmDate(target.value).substring(0,6)) {
		/* 만약 이후달로 이동시 해당일이 없을 경우 그 월의 마지막 일로 선택. */
		if((date.options[0].value <= rmDate(target.value).substring(6,8)) &&
				(date.options[date.options.length-1].value >= rmDate(target.value).substring(6,8)) &&
					toDay  > year.value + month.value + date.value) {
			date.value =  rmDate(target.value).substring(6,8);
		}else{
			date.options[date.options.length-1].selected = true;
		}
	}else{
		/* 만약 이전달에 해당 일이 없으면 첫 날짜로 세팅. */
		if((date.options[0].value <= rmDate(target.value).substring(6,8)) &&
				(date.options[date.options.length-1].value >= rmDate(target.value).substring(6,8)) &&
					fromDay  <= year.value + month.value + date.value) {
			date.value =  rmDate(target.value).substring(6,8);
		}else{
			var monthLastDay = findLeapEndDate(rmDate(target.value).substring(0,4),rmDate(target.value).substring(4,6));
			/* 현재일이 말일이고  시작일보다 선택값이 큰 경우는  말일로 세팅(말일일 경우) 그외는  첫 값으로 세팅함. */
			if(monthLastDay == rmDate(target.value).substring(6,8) && fromDay.substring(0,6) < year.value + month.value){
				date.options[date.options.length-1].selected = true;
			}else{
				date.options[0].selected = true;
			}
		}
	}
	onChangeDate(year,month,date,target);

}

function onChangeLeapPeriodDatetoYear(year,month,date,target,fromDay,toDay) {
	var i = 1;
	var k = 1;
	var cnt = 0;

	date.length = findLeapEndDate(year.value, month.value);

	fromDay = fromDay + "";
	toDay	= toDay   + "";

    if(month.selectedIndex < 0 ) month.selectedIndex = 0;

	var preValue = month.options[month.selectedIndex].value;

	var sYear = fromDay.substring(0,4);
	var sMonth = parseInt(fromDay.substring(4,6),10);
	var sDate = parseInt(fromDay.substring(6,8),10);
	var eYear  = toDay.substring(0,4);
	var eMonth = parseInt(toDay.substring(4,6),10);
	var eDate  = parseInt(toDay.substring(6,8),10);

	/* 선택한 연도가  끝연도 보다 작으며 선택한 연도가 시작연도 보다 클경우 시작연도보다 끝연도가 클경우(month가 1~12) */
	if(	year.value < eYear && year.value > sYear && sYear < eYear ) {
		month.length = 12;
		for(i=1 ; i <= 12; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[cnt].text = k;
			month.options[cnt++].value = k;
			if(preValue == k) month.selectedIndex = cnt-1;
		}
	/* 선택한 연도가  끝연도 보다 작으며 선택한 연도가 시작연도와 같을경우 시작연도보다 끝연도가 클경우(month가 sMonth ~12) */
	}else if( year.value < eYear && year.value == sYear && sYear < eYear ){
		month.length = 13 - sMonth;
		for(i=sMonth ; i <= 12; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[cnt].text = k;
			month.options[cnt++].value = k;
			if(preValue == k) month.selectedIndex = cnt-1;
		}
	/* 선택한 연도가  마지막 연도, 시작연도와 끝연도가 같은 경우 ( 1 ~ eMonth ) */
	}else if( year.value == eYear && sYear != eYear){
		month.length = eMonth;
		for(i=1 ; i <= eMonth; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[cnt].text = k;
			month.options[cnt++].value = k;
			if(preValue == k) month.selectedIndex = cnt-1;
		}
	/* 선택한 연도가  마지막 연도, 시작연도와 끝연도가 같은 경우 ( sMonth ~ eMonth ) */
	}else if( (year.value == eYear && sYear == eYear) ){
		month.length = eMonth-sMonth + 1;
		for(i=sMonth ; i <= eMonth; i++) {
			k = i;
			if(i < 10) k = '0' + k;
			month.options[cnt].text = k;
			month.options[cnt++].value = k;
			if(preValue == k) month.selectedIndex = cnt-1;
		}
	}else{
		/* 이전 연도가 크면 오류? 아니면 값을 바꿔주는 처리. */
		alert("날짜를 다시 입력하세요.");
	}
	/* month.options[month.selectedIndex].selected = true;*/

	k=1;
  	var total_days = (date.length != undefined) ? date.length:1;
  	cnt = 0;
  	/* 최초 시작달일경우.. */
	if(year.value == sYear && month.value == sMonth) {
		if(total_days == findLeapEndDate(year.value, month.value)) {
			date.length = total_days - sDate +1;
		}else {
			date.length = total_days;
		}
		for (i=sDate ;i <= findLeapEndDate(year.value, month.value);i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[cnt].text=k;
			date.options[cnt++].value=k;
		}

	/* 마지막 달일경우..*/
	}else if(year.value == eYear && month.value == eMonth) {
		if(eDate > total_days) eDate = total_days;
		date.length = eDate;
		for (i=1 ;i <= eDate ;i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[cnt].text=k;
			date.options[cnt++].value=k;
		}
	}else {
		for (i=1 ;i <= total_days;i++) {
			k = i;
			if(i < 10) k = '0' + k;
			date.options[i-1].text=k;
			date.options[i-1].value=k;
		}
	}

	if(year.value > target.value.substring(0,4)) {
	    /* 만약 이후년으로 이동시 해당월이 없을 경우 그 해의 마지막 월로 선택. */
		if((month.options[0].value <= rmDate(target.value).substring(4,6)) && (month.options[month.options.length-1].value >= rmDate(target.value).substring(4,6)) ) {
			month.value = rmDate(target.value).substring(4,6);
		}else{
			month.options[month.options.length-1].selected = true;
		}
	}else{
		/* 만약 이전년에 해당 월이 없으면 첫 월로 세팅. */
		if((month.options[0].value <= rmDate(target.value).substring(4,6)) && (month.options[month.options.length-1].value >= rmDate(target.value).substring(4,6)) ) {
			month.value = rmDate(target.value).substring(4,6);
		}else{
			month.options[0].selected = true;
		}
	}

	onChangeLeapPeriodDate(year,month,date,target,fromDay,toDay);
}

/**
 * 셀렉트 박스의 값들을 input tag에 할당함
 * <br>ex : onChangeDate(form1.year,form1.month,form1.date)
 * @param year : 년도 정보를 가지고 있는 객체의 form이름.객체이름
 * @param month : 월 정보를 가지고 있는 객체의 form이름.객체이름
 * @param date : 일 정보를 가지고 있는 객체의 form이름.객체이름
 * @param target : 년,월,일이 들어갈 target input box의   name
 */
function onChangeDate(year,month,date,target) {
	if(target != undefined){
		var targetObj = eval(target);
		if(date.value == undefined) {
			targetObj.value = year.value + "-" + month.value;
		}else{
			targetObj.value = year.value + "-" + month.value + "-" + date.value;
		}
	}
}


/**
 * 해당 년,월에 영향을 받는 해당 년월의 마지막 날짜 찾기
 * <br>ex : findLeapEndDate("2006", "2")
 * @param year : 년도 값
 * @param month : 월 값
 * @return 해당 년월의 마지막 날짜
 */
function findLeapEndDate(year, month) {
  	year  = parseInt(year,10);
	month = parseInt(month,10);

  	var endDay=31;
	if(month == 2) {
		if(( (year % 4 == 0) && (year % 100 != 0) ) || ( year % 400 == 0 ) ) {
			endDay = 29;
		}
		else {
			endDay = 28;
		}
	}
	else if( (month == 4) || (month == 6) || (month == 9) || (month == 11) ) {
		endDay = 30;
	}
	else {
		endDay = 31;
	}
  	return endDay;
}


